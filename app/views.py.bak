from django.shortcuts import render
from django.http import Http404
from django.conf import settings
import os

ARCHIVOS = [
    {'numero': 5, 'titulo': 'Regresión Logística', 'file': '05_Regrecion_Loguistica.html'},
    {'numero': 6, 'titulo': 'Visualización del DataSet', 'file': '06_Visualizacion_DtaSet.html'},
    {'numero': 7, 'titulo': 'División del DataSet', 'file': '07_Divicion_del_DataSet.html'},
    {'numero': 8, 'titulo': 'Preparación del DataSet', 'file': '08_Preparacion_del_DataSet.html'},
    {'numero': 9, 'titulo': 'Transformadores y Pipeline', 'file': '09_Creacion-de-Transformadores-y-Pipeline-Personalizados.html'},
    {'numero': 10, 'titulo': 'Evaluación de Resultados', 'file': '10_Evalucion-de-Resultados.html'},
]


def dashboard(request):
    """Muestra la lista de prácticas en el dashboard."""
    practicas = [{'numero': a['numero'], 'titulo': a['titulo']} for a in ARCHIVOS]
    return render(request, 'dashboard.html', {'practicas': practicas})


def ver_practica(request, numero):
    """Renderiza la práctica dentro del `visor.html` para que se muestre el menú y estilos."""
    archivo_obj = next((a for a in ARCHIVOS if a['numero'] == numero), None)
    if not archivo_obj:
        raise Http404("Práctica no encontrada")

    ruta = os.path.join(settings.BASE_DIR, 'static', 'notebooks', archivo_obj['file'])
    if not os.path.exists(ruta):
        raise Http404("Archivo de la práctica no encontrado")

    indices = [a['numero'] for a in ARCHIVOS]
    idx = indices.index(numero)
    prev_num = indices[idx - 1] if idx > 0 else None
    next_num = indices[idx + 1] if idx < len(indices) - 1 else None

    practicas = [{'numero': a['numero'], 'titulo': a['titulo']} for a in ARCHIVOS]

    context = {
        'archivo': os.path.join('notebooks', archivo_obj['file']),
        'numero': numero,
        'titulo': archivo_obj['titulo'],
        'practicas': practicas,
        'prev_num': prev_num,
        'next_num': next_num,
    }

    return render(request, 'visor.html', context)
