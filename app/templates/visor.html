{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
/* ===== Fondo general ===== */
body {
  background: linear-gradient(135deg, #fff1e6, #fde2cf);
}

/* ===== Sidebar ===== */
.sidebar {
  background: linear-gradient(180deg, #f4a261, #e76f51);
  color: #fff;
  border-radius: 20px;
  position: sticky;
  top: 20px;
  box-shadow: 0 20px 40px rgba(231,111,81,.35);
}

.sidebar h5 {
  font-weight: 700;
  letter-spacing: .5px;
}

/* ===== Lista de prÃ¡cticas ===== */
.practice-item {
  border-radius: 14px;
  padding: 10px;
  transition: all .3s ease;
}

.practice-item:hover {
  background: rgba(255,255,255,.2);
  transform: translateX(6px);
}

.active-practice {
  background: linear-gradient(135deg, #fff3e0, #ffe0cc);
  color: #4a3b2c;
  box-shadow: inset 0 0 0 2px #f4a261,
              0 12px 25px rgba(0,0,0,.15);
}

.active-practice .text-muted {
  color: #6b4e3d !important;
}

.practice-item .btn {
  border-radius: 20px;
  background: #fff;
  color: #e76f51;
  border: none;
}

/* ===== Visor ===== */
.visor-card {
  border-radius: 22px;
  overflow: hidden;
  background: #fffaf5;
  box-shadow: 0 25px 50px rgba(0,0,0,.18);
}

.visor-card .card-header {
  background: linear-gradient(135deg, #e76f51, #d97757);
  color: #fff;
  border-bottom: none;
}

.visor-card h5 {
  font-weight: 700;
}

/* ===== Botones ===== */
.btn-group .btn {
  border-radius: 22px;
}

.btn-warning {
  background: #f4a261;
  border: none;
  color: #4a3b2c;
}

.btn-outline-light {
  border-color: rgba(255,255,255,.6);
}

/* ===== Iframe ===== */
.contenedor-iframe {
  background: #fff1e6;
  border-radius: 0 0 22px 22px;
}

.contenedor-iframe iframe {
  width: 100%;
  height: 78vh;
  border-radius: 16px;
  background: #ffffff;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.05),
              0 15px 30px rgba(0,0,0,.15);
}

/* ===== Texto ===== */
.text-muted {
  color: #6b4e3d !important;
}

/* ===== Responsive ===== */
@media (max-width: 768px) {
  .sidebar {
    position: static;
  }
}
</style>

<div class="row g-4">
  <!-- ===== Sidebar ===== -->
  <div class="col-md-3">
    <aside class="card p-3 sidebar">
      <h5 class="mb-3"> PrÃ¡cticas del Curso</h5>
      <ul class="practice-list list-unstyled mb-0">
        {% for p in practicas %}
        <li class="d-flex justify-content-between align-items-center practice-item
                   {% if p.numero == numero %}active-practice{% endif %}">
          <div>
            <div class="fw-bold">PrÃ¡ctica {{p.numero}}</div>
            <div class="small text-muted">{{p.titulo}}</div>
            {% if p.numero == numero %}
              <div class="small mt-1">{{ practica_info.mini }}</div>
            {% endif %}
          </div>
          <div>
            <a class="btn btn-sm" href="{% url 'ver_practica' p.numero %}">
              Ver
            </a>
          </div>
        </li>
        {% endfor %}
      </ul>
    </aside>
  </div>

  <!-- ===== Visor ===== -->
  <div class="col-md-9">
    <div class="card visor-card">
      <div class="card-header d-flex flex-wrap gap-2 justify-content-between align-items-center">
        <h5 class="mb-0">
          ðŸ“˜ PrÃ¡ctica {{numero}} â€” {{titulo}}
        </h5>

        <div class="btn-group">
          {% if prev_num %}
            <a class="btn btn-outline-light" href="{% url 'ver_practica' prev_num %}">Â«</a>
          {% endif %}

          {% if numero < 5 or numero > 10 %}
            <button id="toggle-code" class="btn btn-outline-light" type="button">
              CÃ³digo
            </button>
          {% endif %}

          <a class="btn btn-warning fw-semibold"
             href="{% static archivo %}" target="_blank" rel="noopener">
             Abrir
          </a>

          {% if next_num %}
            <a class="btn btn-outline-light" href="{% url 'ver_practica' next_num %}">Â»</a>
          {% endif %}
        </div>
      </div>

      <div class="card-body p-0">
        <div class="contenedor-iframe p-3">
          <iframe src="{% static archivo %}" frameborder="0"
                  allowfullscreen title="PrÃ¡ctica {{numero}}">
          </iframe>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const iframe = document.querySelector('.contenedor-iframe iframe');
  const toggleBtn = document.getElementById('toggle-code');

  if (toggleBtn) {
    toggleBtn.addEventListener('click', function(){
      try {
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        const body = doc.body;
        body.classList.toggle('show-code');
        toggleBtn.textContent =
          body.classList.contains('show-code') ? 'Ocultar cÃ³digo' : 'CÃ³digo';
      } catch(e){
        alert('No se pudo alternar la visibilidad del cÃ³digo.');
      }
    });
  }
});
</script>

{% endblock %}
